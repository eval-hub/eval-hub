openapi: 3.1.0
info:
  title: Eval Hub
  description: API REST server for evaluation backend orchestration on OpenShift
  version: 0.1.0
paths:
  /metrics:
    get:
      summary: Metrics
      description: Prometheus metrics endpoint with MLflow health check.
      operationId: metrics_metrics_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
  /api/v1/health:
    get:
      summary: Health Check
      description: Health check endpoint.
      operationId: health_check_api_v1_health_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
  /api/v1/evaluations/jobs:
    post:
      tags:
      - Evaluations
      summary: Create Evaluation
      description: Create and execute evaluation request using the simplified benchmark
        schema.
      operationId: create_evaluation_api_v1_evaluations_jobs_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EvaluationJobRequest'
      responses:
        '202':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvaluationJobResource'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    get:
      tags:
      - Evaluations
      summary: List Evaluations
      description: List all evaluation requests.
      operationId: list_evaluations_api_v1_evaluations_jobs_get
      parameters:
      - name: summary
        in: query
        required: false
        schema:
          type: boolean
          default: false
          title: Summary
        description: Return summary information
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 100
          minimum: 1
          description: Maximum number of evaluations to return
          default: 50
          title: Limit
        description: Maximum number of evaluations to return
      - name: status_filter
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Filter by status
          title: Status Filter
        description: Filter by status
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvaluationJobResourceList'
                title: Response List Evaluations Api V1 Evaluations Jobs Get
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/evaluations/jobs/{id}:
    get:
      tags:
      - Evaluations
      summary: Get Evaluation Status
      description: Get the status of an evaluation request.
      operationId: get_evaluation_status_api_v1_evaluations_jobs__id__get
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
          title: Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvaluationJobResource'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      tags:
      - Evaluations
      summary: Cancel Evaluation
      description: Cancel a running evaluation.
      operationId: cancel_evaluation_api_v1_evaluations_jobs__id__delete
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
          title: Id
      responses:
        '204':
          description: Successful Response
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/metrics/system:
    get:
      summary: Get System Metrics
      description: Get system metrics and statistics.
      operationId: get_system_metrics_api_v1_metrics_system_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                additionalProperties: true
                type: object
                title: Response Get System Metrics Api V1 Metrics System Get
  /api/v1/evaluations/providers:
    get:
      tags:
      - Providers
      summary: List Providers
      description: List all registered evaluation providers.
      operationId: list_providers_api_v1_evaluations_providers_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProviderList'
  /api/v1/evaluations/providers/{id}:
    get:
      tags:
      - Providers
      summary: Get Provider
      description: Get details of a specific provider.
      operationId: get_provider_api_v1_evaluations_providers__provider_id__get
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          title: Provider Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Provider'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/evaluations/benchmarks:
    get:
      tags:
      - Benchmarks
      summary: List All Benchmarks
      description: List all available benchmarks across providers (similar to Llama
        Stack format).
      operationId: list_all_benchmarks_api_v1_evaluations_benchmarks_get
      parameters:
      - name: provider_id
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Filter by provider ID
          title: Provider Id
        description: Filter by provider ID
      - name: category
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Filter by benchmark category
          title: Category
        description: Filter by benchmark category
      - name: tags
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          description: Filter by tags (comma-separated)
          title: Tags
        description: Filter by tags (comma-separated)
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BenchmarksList'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/evaluations/collections:
    get:
      tags:
      - Collections
      summary: List Collections
      description: List all benchmark collections.
      operationId: list_collections_api_v1_evaluations_collections_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionResourceList'
    post:
      tags:
      - Collections
      summary: Create Collection
      description: Create a new collection.
      operationId: create_collection_api_v1_evaluations_collections_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CollectionCreationRequest'
        required: true
      responses:
        '201':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionResource'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/evaluations/collections/{id}:
    get:
      tags:
      - Collections
      summary: Get Collection
      description: Get details of a specific collection.
      operationId: get_collection_api_v1_evaluations_collections__collection_id__get
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          title: Collection Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionResource'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    patch:
      tags:
      - Collections
      summary: Patch Collection
      description: Partially update an existing collection.
      operationId: patch_collection_api_v1_evaluations_collections__collection_id__patch
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          title: Collection Id
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Patch'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionResource'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      tags:
      - Collections
      summary: Delete Collection
      description: Delete a collection.
      operationId: delete_collection_api_v1_evaluations_collections__collection_id__delete
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          title: Collection Id
      responses:
        '204':
          description: Successful Response

        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
components:
  schemas:
    Patch:
      type: array
      items: 
        type: object
        properties:
          op:
            type: string
            enum:
              - replace
              - add
              - remove
          path:
            type: string
          value:
            type: object

    Page:
      type: object
      properties:
        first:
          type: object
          properties:
            href:
              type: string
        next:
          type: object
          properties:
            href:
              type: string
        limit:
          type: integer
        total_count:
          type: integer

    Status:
      type: object
      properties:
        state:
          type: string
          enum:
          - pending
          - running
          - completed
          - failed
          - cancelled
        message:
          type: string

        benchmarks:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              state:
                type: string
                enum:
                - pending
                - running
                - completed
                - failed
                - cancelled
              started_at:
                type: string
                format: date-time
              completed_at:
                type: string
                format: date-time
              message:
                type: string
              logs:
                type: object
                properties:
                  path:
                    type: string              
    Resource:
      type: object
      properties:
        id:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    EvaluationJobRequest:
      title: EvaluationJobRequest
      description: Simplified evaluation request using the new schema.
      type: object
      properties:
        model:
          type: object
          properties:
            url:
              type: string
              title: Url
              description: Model endpoint URL
            name:
              type: string
              title: Name
              description: Model name/identifier
          required:
          - url
          - name
        
        benchmarks:
          type: array
          title: Benchmarks
          description: List of benchmarks to evaluate
          items:
            properties:
              name:
                type: string
                description: the user provide name for this benchmark
              id:
                type: string
                title: Benchmark Id
                description: Benchmark identifier
              provider_id:
                type: string
                title: Provider Id
                description: Provider identifier
              config:
                type: object
                title: Config
                description: Benchmark configuration including num_fewshot, limit,    batch_size, etc.

        experiment:
          description: Experiment configuration for MLFlow tracking
          type: object
          properties:
            name:
              type: string
              title: Name
              description: Experiment name for MLFlow tracking
            tags:
              type: object
              title: Tags
              description: Tags for the evaluation experiment
              additionalProperties:
                type: string

        timeout_minutes:
          type: integer
          title: Timeout Minutes
          description: Timeout for the entire evaluation
          default: 60
        retry_attempts:
          type: integer
          title: Retry Attempts
          description: Number of retry attempts on failure
          default: 3
        callback_url:
          anyOf:
          - type: string
          - type: 'null'
          title: Callback Url
          description: URL to call when evaluation completes
      required:
      - model
      - benchmarks
      - experiment


    EvaluationJobResource:
      allOf:
        - properties:
            resource:
              $ref: '#/components/schemas/Resource'
        - properties:
            status:
              $ref: '#/components/schemas/Status'
        - properties:
            results:
              type: object
              title: Results
              description: Evaluation results
              properties:
                total_evaluations:
                  type: integer
                  title: Total Evaluations
                  description: Total number of evaluations
                completed_evaluations:
                  type: integer
                  title: Completed Evaluations
                  description: Number of completed evaluations
                  default: 0
                failed_evaluations:
                  type: integer
                  title: Failed Evaluations
                  description: Number of failed evaluations
                  default: 0
                benchmarks:
                  type: array
                  items:
                    type: object
                    title: EvaluationResult
                    description: Result of a single evaluation.
                    properties:
                      name: 
                        type: string
                      metrics:
                        additionalProperties:
                          anyOf:
                          - type: number
                          - type: integer
                          - type: string
                        type: object
                        title: Metrics
                        description: Evaluation metrics
                      artifacts:
                        additionalProperties:
                          type: string
                        type: object
                        title: Artifacts
                        description: Paths to result artifacts
                      mlflow_run_id:
                        anyOf:
                        - type: string
                        - type: 'null'
                        title: Mlflow Run Id
                        description: MLFlow run ID
                    required:
                    - provider_id
                    - id
                    - status
                aggregated_metrics:
                  additionalProperties:
                    anyOf:
                    - type: number
                    - type: integer
                    - type: string
                  type: object
                  title: Aggregated Metrics
                  description: Aggregated metrics across all evaluations
                mlflow_experiment_url:
                  anyOf:
                  - type: string
                  - type: 'null'
                  title: Experiment Url
                  description: MLFlow experiment URL

        - $ref: '#/components/schemas/EvaluationJobRequest'

          required:
          - id
          - status
          - total_evaluations
          - created_at

    EvaluationJobResourceList:
      allOf:
        - $ref: '#/components/schemas/Page'
        - properties:
            items: 
              type: array
              items:
                $ref: '#/components/schemas/EvaluationJobResource'


    BenchmarkReference:
      type: object
      title: BenchmarkReference
      description: Reference to a benchmark within a collection.
      properties:
        provider_id:
          type: string
          title: Provider Id
          description: Provider identifier
        id:
          type: string
          title: Benchmark Id
          description: Benchmark identifier
        weight:
          type: number
          title: Weight
          description: Weight for this benchmark in collection scoring
          default: 1.0
        config:
          additionalProperties: true
          type: object
          title: Config
          description: Benchmark-specific configuration
      required:
      - provider_id
      - id


    CollectionCreationRequest:
      type: object
      title: CollectionCreationRequest
      description: Request for creating a new collection.
      properties:
        name:
          type: string
          title: Name
          description: Human-readable collection name
        description:
          type: string
          title: Description
          description: Collection description
        tags:
          type: array
          title: Tags
          description: Tags for categorizing the collection
          items:
            type: string
        custom:
          type: object
          title: Custom
          description: Additional collection metadata
          additionalProperties: true
        benchmarks:
          type: array
          title: Benchmarks
          description: List of benchmark references in this collection
          items:
            $ref: '#/components/schemas/BenchmarkReference'

      required:
      - name
      - description
      - benchmarks


    CollectionUpdateRequest:
      properties:
        name:
          anyOf:
          - type: string
          - type: 'null'
          title: Name
          description: Human-readable collection name
        description:
          anyOf:
          - type: string
          - type: 'null'
          title: Description
          description: Collection description
        provider_id:
          anyOf:
          - type: string
          - type: 'null'
          title: Provider Id
          description: Primary provider for this collection
        tags:
          anyOf:
          - items:
              type: string
            type: array
          - type: 'null'
          title: Tags
          description: Tags for categorizing the collection
        metadata:
          anyOf:
          - additionalProperties: true
            type: object
          - type: 'null'
          title: Metadata
          description: Additional collection metadata
        benchmarks:
          anyOf:
          - items:
              $ref: '#/components/schemas/BenchmarkReference'
            type: array
          - type: 'null'
          title: Benchmarks
          description: List of benchmark references in this collection
      additionalProperties: true
      type: object
      title: CollectionUpdateRequest
      description: Request for updating an existing collection.


    Benchmark:
      type: object
      title: Benchmark
      description: Benchmark specification.
      properties:
        id:
          type: string
          title: Benchmark Id
          description: Unique benchmark identifier
        provider_id:
          type: string
          description: The provider of this banchmark
        label:
          type: string
          title: Label
          description: Human-readable benchmark name
        description:
          type: string
          title: Description
          description: Benchmark description
        category:
          type: string
          title: Category
          description: Benchmark category
        metrics:
          items:
            type: string
          type: array
          title: Metrics
          description: List of metrics provided by this benchmark
        num_few_shot:
          type: integer
          title: Num Few Shot
          description: Number of few-shot examples
        dataset_size:
          anyOf:
          - type: integer
          - type: 'null'
          title: Dataset Size
          description: Size of the evaluation dataset
        tags:
          items:
            type: string
          type: array
          title: Tags
          description: Tags for categorization
      required:
      - id
      - name
      - description
      - category
      - metrics
      - num_few_shot

    BenchmarksList:
      type: object
      title: BenchmarksList
      description: Response for listing all benchmarks (similar to Llama Stack format).
      properties:
        total_count:
          type: integer
          title: Total Count
          description: Total number of benchmarks
        items:
          type: array
          items:
            $ref: '#/components/schemas/Benchmark'

          title: Benchmarks
          description: List of all available benchmarks

      additionalProperties: true
      required:
      - items
      - total_count

    CollectionResourceList:
      allOf:
        - $ref: '#/components/schemas/Page'
        - properties:
            items: 
              type: array
              items:
                $ref: '#/components/schemas/CollectionResource'

    ProviderList:
      type: object
      required:
      - providers
      - total_providers
      - total_benchmarks
      title: ListProvidersResponse
      description: Response for listing all providers.
      properties:
        total_count:
          type: integer
          title: Total Providers
          description: Total number of providers
        items:
          items:
            $ref: '#/components/schemas/Provider'
          type: array
          title: Providers
          description: List of available providers


    Provider:
      type: object
      properties:
        id:
          type: string
        label:
          type: string
          description: to be rendered by UI
        supported_benchmarks:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
    
    CollectionResource:
      allOf:
        - properties:
            resource:
              $ref: '#/components/schemas/Resource'
        - $ref: '#/components/schemas/CollectionCreationRequest'


    HealthResponse:
      properties:
        status:
          type: string
          title: Status
          description: Overall health status
        version:
          type: string
          title: Version
          description: Service version
        timestamp:
          type: string
          format: date-time
          title: Timestamp
          description: Health check timestamp
        components:
          additionalProperties:
            additionalProperties: true
            type: object
          type: object
          title: Components
          description: Health status of individual components
        uptime_seconds:
          type: number
          title: Uptime Seconds
          description: Service uptime in seconds
        active_evaluations:
          type: integer
          title: Active Evaluations
          description: Number of active evaluations
          default: 0
      type: object
      required:
      - status
      - version
      - uptime_seconds
      title: HealthResponse
      description: Health check response.


    Error:
      type: object
      title: Error
      properties:
        code:
          type: string
        message:
          type: string
          title: Message
        type:
          type: string
          title: Error Type

